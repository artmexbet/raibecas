<!-- filepath: c:\Users\artem\GolandProjects\raibecas\services\auth\docs\SEQUENCE_DIAGRAMS.md -->

# Auth Service - –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Sequence Diagrams) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Å–µ—Ä–≤–∏—Å–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–æ–≤ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–æ–∫.

---

## üìä –í—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** (`registration_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- User - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Client/Gateway - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Registration Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Registration Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- PostgreSQL - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- Admin Service - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- Event Publisher - –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
2. Gateway –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `auth.register`
3. RegHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. RegService –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å email
5. –ï—Å–ª–∏ email —Å–≤–æ–±–æ–¥–µ–Ω:
   - –ü–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è (bcrypt)
   - –ó–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
   - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `auth.registration.requested`
   - AdminService –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
6. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä—è–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç:
   - –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏: —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è `auth.user.registered`
   - –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏: –∑–∞—è–≤–∫–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `rejected`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

### 2. **–í—Ö–æ–¥** (`login_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–æ–≤.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- User - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Client/Gateway - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Auth Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Auth Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- JWT Manager - –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤
- PostgreSQL - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- Redis - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- Event Publisher - –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
- Other Services - –¥—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email –∏ –ø–∞—Ä–æ–ª—å
2. Gateway –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `auth.login`
3. AuthHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. AuthService –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ PostgreSQL
5. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å (bcrypt verify)
   - –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π:
     - JWT Manager –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç access_token (TTL 15 –º–∏–Ω)
     - JWT Manager –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç refresh_token (TTL 7 –¥–Ω–µ–π)
     - –û–±–∞ —Ç–æ–∫–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis
     - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `auth.user.login`
     - –¢–æ–∫–µ–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É
6. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è "Invalid credentials"

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- ‚ùå –ü–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω

---

### 3. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞** (`validate_token_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ access —Ç–æ–∫–µ–Ω–∞ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- External Service - –¥—Ä—É–≥–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Auth Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Auth Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- JWT Manager - –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. ExternalService –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç token –≤ `auth.validate`
2. AuthHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
3. AuthService –≤—ã–∑—ã–≤–∞–µ—Ç JWT Manager
4. JWT Manager –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –ü–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ (HMAC-SHA256)
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (exp claim)
   - –°—Ç—Ä—É–∫—Ç—É—Ä—É JWT
5. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω:
   - –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è claims (user_id, role, username, email)
   - ExternalService —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
6. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è {valid: false}
   - ExternalService –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å
7. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è {valid: false}
   - ExternalService –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω (refresh)

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
- ‚ùå –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ (exp < now)
- ‚ùå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT –Ω–∞—Ä—É—à–µ–Ω–∞

---

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** (`refresh_token_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ access —Ç–æ–∫–µ–Ω–∞ –ø–æ refresh —Ç–æ–∫–µ–Ω—É —Å —Ä–æ—Ç–∞—Ü–∏–µ–π.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- User - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Client/Gateway - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Auth Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Auth Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- JWT Manager - –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤
- Redis - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- PostgreSQL - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç refresh_token
2. Gateway –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `auth.refresh`
3. AuthHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. AuthService –ø—Ä–æ–≤–µ—Ä—è–µ—Ç refresh_token –≤ Redis:
   - –ò—â–µ—Ç –ø–æ `refresh_token:value:{token}`
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –ø–æ–ª—É—á–∞–µ—Ç user_id
5. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –≤ Redis:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "Invalid or expired token"
6. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ PostgreSQL
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–∞–Ω - –æ—à–∏–±–∫–∞
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω:
     - JWT Manager –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π access_token
     - JWT Manager –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π refresh_token (—Ä–æ—Ç–∞—Ü–∏—è!)
     - –°—Ç–∞—Ä—ã–π refresh_token —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ Redis
     - –ù–æ–≤—ã–π refresh_token —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis
     - –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ–±–∞ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–∞

**–í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üîÑ **–†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** - –ø—Ä–∏ –∫–∞–∂–¥–æ–º refresh –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π refresh_token
- üîí **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** - —Å—Ç–∞—Ä—ã–π refresh_token —Å—Ä–∞–∑—É —É–¥–∞–ª—è–µ—Ç—Å—è
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–º

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå Refresh token –∏—Å—Ç—ë–∫
- ‚ùå Refresh token –±—ã–ª —É–¥–∞–ª—ë–Ω
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω

---

### 5. **–í—ã—Ö–æ–¥ (–æ–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)** (`logout_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏, —É–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ refresh —Ç–æ–∫–µ–Ω–∞.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- User - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Client/Gateway - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Auth Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Auth Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- JWT Manager - –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤
- Redis - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- Event Publisher - –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
- Other Services - –¥—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. User –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–í—ã—Ö–æ–¥"
2. Gateway –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `auth.logout`
3. AuthHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. AuthService –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç access_token:
   - JWT Manager –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫
   - –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è claims (user_id)
5. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω - –æ—à–∏–±–∫–∞ "Unauthorized"
6. –ï—Å–ª–∏ user_id –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç - –æ—à–∏–±–∫–∞ "Unauthorized"
7. –ï—Å–ª–∏ –≤—Å—ë OK:
   - AuthService —É–¥–∞–ª—è–µ—Ç refresh_token –∏–∑ Redis:
     - –£–¥–∞–ª—è–µ—Ç `refresh_token:value:{token}`
     - –£–¥–∞–ª—è–µ—Ç `refresh_token:user:{user_id}:{device_id}`
   - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `auth.user.logout`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —É—Å–ø–µ—Ö

**–û—Ç–ª–∏—á–∏–µ –æ—Ç LogoutAll:**
- ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω** refresh_token (—ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- ‚úÖ –î—Ä—É–≥–∏–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
- üíæ Access_token –∫–ª–∏–µ–Ω—Ç–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –¥–æ TTL (15 –º–∏–Ω)

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
- ‚ùå –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ –∏—Å—Ç—ë–∫
- ‚ùå user_id –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

---

### 6. **–í—ã—Ö–æ–¥ (–≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)** (`logout_all_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π, —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö refresh —Ç–æ–∫–µ–Ω–æ–≤.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- User - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Client/Gateway - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Auth Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Auth Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- JWT Manager - –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤
- Redis - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- Event Publisher - –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
- Other Services - –¥—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. User –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤"
2. Gateway –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `auth.logout_all`
3. AuthHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. AuthService –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç access_token
5. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω - –æ—à–∏–±–∫–∞ "Unauthorized"
6. –ï—Å–ª–∏ –≤—Å—ë OK:
   - AuthService —Å–∫–∞–Ω–∏—Ä—É–µ—Ç Redis –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É `refresh_token:user:{user_id}:*`
   - –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö device_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ device_id:
     - –ü–æ–ª—É—á–∞–µ—Ç token_value –∏–∑ Redis
     - –£–¥–∞–ª—è–µ—Ç `refresh_token:user:{user_id}:{device_id}`
     - –£–¥–∞–ª—è–µ—Ç `refresh_token:value:{token_value}`
   - **–í—Å–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–∫—Ä—ã—Ç—ã**
   - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `auth.user.logout` —Å —Ñ–ª–∞–≥–æ–º `all_devices=true`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —É—Å–ø–µ—Ö

**–û—Ç–ª–∏—á–∏–µ –æ—Ç Logout:**
- ‚ùå –£–¥–∞–ª—è—é—Ç—Å—è **–í–°–ï** refresh_tokens –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚ùå –í—Å–µ —Å–µ—Å—Å–∏–∏ –≤–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
- üíæ Access_tokens –æ—Å—Ç–∞—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–æ TTL

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- üîí –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- üîê –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
- üõ°Ô∏è –ü–æ–≤—ã—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

### 7. **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è** (`change_password_seq.mermaid`)
**–ü—Ä–æ—Ü–µ—Å—Å:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã—Ö–æ–¥–æ–º —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:**
- User - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- Client/Gateway - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- NATS Broker - —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- Auth Handler - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- Auth Service - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- JWT Manager - –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤
- Password Manager - –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π
- PostgreSQL - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- Redis - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- Event Publisher - –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
- Other Services - –¥—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:**
1. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
2. Gateway –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `auth.change_password`
3. AuthHandler –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. AuthService –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç access_token:
   - JWT Manager –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫
   - –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è claims (user_id)
5. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω - –æ—à–∏–±–∫–∞ "Unauthorized"
6. –ï—Å–ª–∏ –≤—Å—ë OK:
   - AuthService –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ PostgreSQL
   - Password Manager –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å:
     - –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π - –æ—à–∏–±–∫–∞
     - –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π:
       - Password Manager —Ö–µ—à–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (bcrypt, cost=12)
       - PostgreSQL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º password_hash
       - **–í—Å–µ refresh_tokens —É–¥–∞–ª—è—é—Ç—Å—è** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π LogoutAll):
         - Redis —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É `refresh_token:user:{user_id}:*`
         - –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –≤—Å–µ—Ö device_id
       - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `auth.password.reset`
       - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —É—Å–ø–µ—Ö

**–í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã–º –ø–∞—Ä–æ–ª–µ–º
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π LogoutAll** - –≤—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- üõ°Ô∏è –í—Å–µ —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ —Ü–µ–ª—è—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üìß –°–æ–±—ã—Ç–∏–µ `auth.password.reset` –ø–æ–∑–≤–æ–ª—è–µ—Ç:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ email
  - –û–ø–æ–≤–µ—Å—Ç–∏—Ç—å –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è
  - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ –∞—É–¥–∏—Ç–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é:**
- ‚úÖ –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ù–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ —Å—Ç–∞—Ä—ã–º –ø–∞—Ä–æ–ª–µ–º
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: —Å–º–µ—Å—å –±—É–∫–≤, —Ü–∏—Ñ—Ä, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
- ‚ùå –°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π
- ‚ùå –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π

---

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Logout | LogoutAll | ChangePassword |
|----------|--------|-----------|----------------|
| **–£–¥–∞–ª—è–µ—Ç** | 1 refresh token | –í–°–ï refresh tokens | –í–°–ï refresh tokens |
| **–û–±–Ω–æ–≤–ª—è–µ—Ç –ë–î** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ (–ø–∞—Ä–æ–ª—å) |
| **–¢—Ä–µ–±—É–µ—Ç —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–î—Ä—É–≥–∏–µ —Å–µ—Å—Å–∏–∏** | –ê–∫—Ç–∏–≤–Ω—ã | –ó–∞–∫—Ä—ã—Ç—ã | –ó–∞–∫—Ä—ã—Ç—ã |
| **–°–æ–±—ã—Ç–∏–µ** | logout | logout | password.reset |
| **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å** | –Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å | –Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å | –Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å |

---

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ –ø–æ—Ç–æ–∫–∏

### –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```
Registration (User ‚Üí Admin) ‚Üí Approval ‚Üí Login ‚Üí Validate ‚Üí ...
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞
```
Login (get tokens) ‚Üí [use access_token] ‚Üí expire ‚Üí Refresh (get new tokens) ‚Üí [continue]
```

### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
```
Old session ‚Üí ChangePassword ‚Üí LogoutAll (all devices) ‚Üí Login (new password)
```

### –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
```
[Detect threat] ‚Üí LogoutAll ‚Üí Event ‚Üí Other Services notify user
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–≥—Ä–∞–º–º–∞—Ö

### Success Flow
```
Client ‚Üí NATS ‚Üí Handler ‚Üí Service ‚Üí (DB/Cache) ‚Üí Service ‚Üí Handler ‚Üí Event ‚Üí NATS ‚Üí Client
```

### Error Flow
```
Client ‚Üí NATS ‚Üí Handler ‚Üí (validation fails) ‚Üí Handler ‚Üí NATS ‚Üí Client (error response)
```

### Event Publishing
```
Handler ‚Üí EventPublisher ‚Üí NATS ‚Üí Other Services (subscribe)
```

---

## üíæ –û—á–µ—Ä—ë–¥–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –≤ Redis/DB

### Login
1. Generate tokens
2. Save to Redis
3. Return tokens

### Refresh
1. Validate in Redis
2. Delete old tokens
3. Generate new tokens
4. Save to Redis
5. Return tokens

### Logout
1. Find token in Redis
2. Delete both indices
3. Return success

### LogoutAll
1. Scan all devices
2. Delete all tokens
3. Return success

### ChangePassword
1. Verify old password
2. Hash new password
3. Update in DB
4. Delete all tokens from Redis
5. Return success

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ –¥–∏–∞–≥—Ä–∞–º–º–∞—Ö

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
- ‚úÖ –í—Å–µ –ø–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è bcrypt (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)
- ‚úÖ –í—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã HMAC-SHA256 (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å)
- ‚úÖ Access —Ç–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç –∫–æ—Ä–æ—Ç–∫–∏–π TTL (15 –º–∏–Ω)
- ‚úÖ Refresh —Ç–æ–∫–µ–Ω—ã —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è (—Å—Ç–∞—Ä—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è)
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è –≤—Å–µ —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- ‚úÖ Email —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–∞—Ä–æ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ (bcrypt)
- ‚úÖ –¢–æ–∫–µ–Ω—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- ‚úÖ User_id –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ logout
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ refresh

---

## üìñ –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã

- [registration_seq.mermaid](./registration_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [login_seq.mermaid](./login_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—Ö–æ–¥–∞
- [validate_token_seq.mermaid](./validate_token_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [refresh_token_seq.mermaid](./refresh_token_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [logout_seq.mermaid](./logout_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—ã—Ö–æ–¥–∞
- [logout_all_seq.mermaid](./logout_all_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—ã—Ö–æ–¥–∞ –≤—Å–µ—Ö
- [change_password_seq.mermaid](./change_password_seq.mermaid) - –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è

---

## üéì –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —á—Ç–µ–Ω–∏—è

1. [login_seq.mermaid](./login_seq.mermaid) - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
2. [refresh_token_seq.mermaid](./refresh_token_seq.mermaid) - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
3. [logout_seq.mermaid](./logout_seq.mermaid) - –≤—ã—Ö–æ–¥
4. [validate_token_seq.mermaid](./validate_token_seq.mermaid) - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
5. [registration_seq.mermaid](./registration_seq.mermaid) - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
6. [change_password_seq.mermaid](./change_password_seq.mermaid) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º
7. [logout_all_seq.mermaid](./logout_all_seq.mermaid) - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

**–í–µ—Ä—Å–∏—è: 1.0 | –î–∞—Ç–∞: 2025-01-03 | –°—Ç–∞—Ç—É—Å: ‚úÖ –ü–æ–ª–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

