# Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ: Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ Ğ°Ğ¹Ğ±ĞµĞºĞ°Ñ (v2.0)

## 1. ĞĞ±Ğ·Ğ¾Ñ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

**Ğ¦ĞµĞ»ÑŒ**: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ²ĞµĞ±-Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ½Ğ°ÑƒÑ‡Ğ½Ñ‹Ğ¼Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ°Ğ¼Ğ¸ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ° Ğ.Ğ¯. Ğ Ğ°Ğ¹Ğ±ĞµĞºĞ°ÑĞ° Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ AI-Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ RAG.

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ¸Ñ‡Ğ¸**:
- Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Markdown-Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
- Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ‚ĞµĞºÑÑ‚Ğ° Ñ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ñ‹Ğ¼Ğ¸ ÑÑÑ‹Ğ»ĞºĞ°Ğ¼Ğ¸
- RAG-based Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚ Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ÑĞ¼Ğ¸ (Ollama)
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¹
- ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸ ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº**:

### Backend
- **Ğ¯Ğ·Ñ‹ĞºĞ¸**: Go (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹), Python (ML Pipeline)
- **API Gateway**: Go + Fiber
- **Message Broker**: NATS (Ğ¸Ğ»Ğ¸ RabbitMQ)
- **Databases**:
    - PostgreSQL (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ‘Ğ”)
    - pgvector (Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¸)
    - Redis (ĞºÑÑˆ, ÑĞµÑÑĞ¸Ğ¸)
- **Search**: Meilisearch
- **LLM**: Ollama (Llama 3.1, Mistral)
- **Embeddings**: sentence-transformers (all-MiniLM-L6-v2)

### Frontend
- **Framework**: SvelteKit
- **State Management**: Svelte stores
- **Styling**: TailwindCSS
- **Build**: Vite

### Infrastructure
- **Containerization**: Docker + Docker Compose
- **Reverse Proxy**: Nginx
- **Monitoring**: Prometheus + Grafana
- **Logging**: Loki

---

## 2. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### 2.1. ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ Event-Driven Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NGINX (Reverse Proxy)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SvelteKit Frontend â”‚         â”‚  Static Assets â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          API Gateway (Go + Fiber)                     â”‚
    â”‚  - Authentication/Authorization (JWT)                 â”‚
    â”‚  - Rate Limiting                                      â”‚
    â”‚  - Request Validation                                 â”‚
    â”‚  - WebSocket handler (Ğ´Ğ»Ñ Ñ‡Ğ°Ñ‚Ğ°)                       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚          â”‚                  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
         â”‚  â”‚   NATS Message       â”‚   â”‚
         â”‚  â”‚      Broker          â”‚â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
         â”‚          â”‚                  â”‚              â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Auth   â”‚ â”‚  Corpus   â”‚ â”‚    User     â”‚ â”‚   Indexing   â”‚
    â”‚ Service â”‚ â”‚  Service  â”‚ â”‚   Service   â”‚ â”‚   Service    â”‚
    â”‚  (Go)   â”‚ â”‚   (Go)    â”‚ â”‚    (Go)     â”‚ â”‚   (Python)   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚              â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                           â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PostgreSQL    â”‚  â”‚ Meilisearch  â”‚  â”‚   Redis Cache    â”‚
    â”‚  (+ pgvector)  â”‚  â”‚   (Search)   â”‚  â”‚   (Sessions)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Chat Service   â”‚      â”‚   Ollama Server   â”‚
    â”‚    (Python)      â”‚â”€â”€â”€â”€â”€â”€â–º  (LLM + Embed.)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2. ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Event-Driven)

#### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°

```
Admin UI â†’ API Gateway â†’ Corpus Service
                              â†“
                    Publish: document.created
                              â†“
                         NATS Broker
                         â†™          â†˜
        Indexing Service          Search Service
        (ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ embeddings)      (Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ² Meilisearch)
                â†“                        â†“
          Vector DB              Meilisearch
                â†“
    Publish: document.indexed
                â†“
          Chat Service
      (Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°ĞµÑ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ)
```

#### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ² Ñ‡Ğ°Ñ‚

```
User â†’ WebSocket (API Gateway) â†’ Chat Service
                                       â†“
                              1. Semantic Search
                              2. Context Building
                              3. LLM Query (Ollama)
                                       â†“
                              Publish: message.created
                                       â†“
                                  NATS Broker
                                       â†“
                               User Service
                          (ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ)
                                       â†“
                        WebSocket Response â†’ User
```

---

## 3. Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ Ğ¸Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ

### 3.1. API Gateway (Go)
**ĞŸĞ¾Ñ€Ñ‚**: 8080  
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**:
- Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ²ÑĞµÑ… HTTP/WebSocket Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- JWT Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- Rate limiting (per user, per endpoint)
- ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼
- WebSocket handler Ğ´Ğ»Ñ real-time Ñ‡Ğ°Ñ‚Ğ°
- CORS, security headers

**REST Endpoints**:
- `/api/v1/auth/*` â†’ Auth Service
- `/api/v1/documents/*` â†’ Corpus Service
- `/api/v1/fragments/*` â†’ User Service
- `/api/v1/notes/*` â†’ User Service
- `/api/v1/search/*` â†’ Corpus Service
- `/api/v1/admin/*` â†’ Admin operations (multiple services)

**WebSocket**:
- `/ws/chat` â†’ Chat Service (Ñ‡ĞµÑ€ĞµĞ· NATS)

**Dependencies**:
- NATS (Ğ´Ğ»Ñ pub/sub)
- Redis (Ğ´Ğ»Ñ rate limiting Ğ¸ sessions)

---

### 3.2. Auth Service (Go)
**ĞŸĞ¾Ñ€Ñ‚**: 8081  
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**:
- Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
- ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (login/logout)
- JWT token management (issue, refresh, revoke)
- Password reset (Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°)
- User session management

**Database Tables**:
- `users`
- `registration_requests`
- `refresh_tokens`

**Published Events**:
- `user.registered` (username, user_id)
- `user.login` (user_id, timestamp)
- `user.logout` (user_id)
- `password.reset` (user_id)

**Subscribed Events**:
- `registration.approved` (Ğ¾Ñ‚ Admin Service)
- `registration.rejected` (Ğ¾Ñ‚ Admin Service)

**REST API**:
- `POST /register` - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ
- `POST /login` - Ğ²Ñ…Ğ¾Ğ´
- `POST /logout` - Ğ²Ñ‹Ñ…Ğ¾Ğ´
- `POST /refresh` - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½
- `POST /change-password` - ÑĞ¼ĞµĞ½Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ

---

### 3.3. Corpus Service (Go)
**ĞŸĞ¾Ñ€Ñ‚**: 8082  
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**:
- CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸/Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ°Ğ¼Ğ¸
- Ğ’ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
- ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº (Ñ‡ĞµÑ€ĞµĞ· Meilisearch)
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸

**Database Tables**:
- `authors`
- `documents`
- `document_versions`

**Published Events**:
- `document.created` (document_id, content, metadata)
- `document.updated` (document_id, old_version, new_version, content)
- `document.deleted` (document_id)
- `author.created` (author_id, name)

**Subscribed Events**:
- `document.indexed` (Ğ¾Ñ‚ Indexing Service) - Ğ¿Ğ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹

**REST API**:
- `GET /documents` - ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼Ğ¸)
- `GET /documents/:id` - Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚
- `POST /documents` (admin) - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚
- `PUT /documents/:id` (admin) - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚
- `DELETE /documents/:id` (admin) - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚
- `GET /documents/:id/versions` - Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²ĞµÑ€ÑĞ¸Ğ¹
- `GET /search` - Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº

---

### 3.4. User Service (Go)
**ĞŸĞ¾Ñ€Ñ‚**: 8083  
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**:
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ (ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ, Ğ¿Ğ¾Ğ¸ÑĞº, sharing)
- ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ° (Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ)
- ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

**Database Tables**:
- `fragments`
- `notes`
- `chat_sessions`
- `chat_messages`

**Published Events**:
- `fragment.created` (fragment_id, user_id, document_id)
- `fragment.deleted` (fragment_id)
- `note.created` (note_id, user_id)
- `chat.history_deleted` (user_id) - Ğ´Ğ»Ñ GDPR compliance

**Subscribed Events**:
- `message.created` (Ğ¾Ñ‚ Chat Service) - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ
- `document.updated` (Ğ¾Ñ‚ Corpus Service) - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ñ‹ Ğ½Ğ° Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

**REST API**:
- `GET /fragments` - Ğ¼Ğ¾Ğ¸ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ñ‹
- `POST /fragments` - ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚
- `GET /fragments/:token` - Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ share-ÑÑÑ‹Ğ»ĞºĞµ
- `DELETE /fragments/:id` - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚
- `GET /notes` - Ğ¼Ğ¾Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
- `POST /notes` - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ
- `PUT /notes/:id` - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ
- `DELETE /notes/:id` - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ
- `GET /chat/sessions` - Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞµÑÑĞ¸Ğ¹
- `GET /chat/sessions/:id` - ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ÑĞµÑÑĞ¸Ğ¸
- `DELETE /chat/sessions/:id` - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞµÑÑĞ¸Ñ
- `DELETE /chat/history` - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ

---

### 3.5. Indexing Service (Python)
**ĞŸĞ¾Ñ€Ñ‚**: 8084  
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**:
- Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²ĞºĞ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ½Ğ° Ñ‡Ğ°Ğ½ĞºĞ¸ (chunking)
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ² (Ñ‡ĞµÑ€ĞµĞ· Ollama)
- Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ Ğ² Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½ÑƒÑ Ğ‘Ğ” (pgvector)
- Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ Ğ² Meilisearch
- Batch processing Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²

**Database Tables**:
- `document_embeddings` (Ñ‡ĞµÑ€ĞµĞ· pgvector)

**Published Events**:
- `document.indexed` (document_id, chunks_count, status)
- `indexing.failed` (document_id, error)

**Subscribed Events**:
- `document.created` (Ğ¾Ñ‚ Corpus Service)
- `document.updated` (Ğ¾Ñ‚ Corpus Service)
- `document.deleted` (Ğ¾Ñ‚ Corpus Service)

**Dependencies**:
- Ollama (Ğ´Ğ»Ñ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²: nomic-embed-text Ğ¸Ğ»Ğ¸ all-minilm)
- PostgreSQL + pgvector
- Meilisearch

**REST API** (internal):
- `POST /index-document` - Ñ€ÑƒÑ‡Ğ½Ğ°Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ
- `GET /index-status/:document_id` - ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸

---

### 3.6. Chat Service (Python)
**ĞŸĞ¾Ñ€Ñ‚**: 8085  
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**:
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚Ñƒ
- RAG: semantic search + context building
- Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Ollama LLM
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸ (Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹/Ğ°ĞºĞ°Ğ´ĞµĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼)
- Streaming Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· WebSocket

**Published Events**:
- `message.created` (session_id, role, content, sources, timestamp)
- `chat.session_started` (session_id, user_id, mode)

**Subscribed Events**:
- `chat.query` (Ğ¾Ñ‚ API Gateway Ñ‡ĞµÑ€ĞµĞ· WebSocket)

**Dependencies**:
- Ollama (LLM: llama3.1, mistral)
- PostgreSQL + pgvector (Ğ´Ğ»Ñ semantic search)
- Redis (Ğ´Ğ»Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°)

**WebSocket Protocol**:
```json
// Client â†’ Server
{
  "type": "chat.message",
  "session_id": "uuid",
  "message": "Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ğ´Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ¸ĞºĞ°?",
  "mode": "popular"
}

// Server â†’ Client (streaming)
{
  "type": "chat.response.chunk",
  "session_id": "uuid",
  "chunk": "Ğ”Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ¸ĞºĞ° â€” ÑÑ‚Ğ¾...",
  "done": false
}

// Server â†’ Client (final)
{
  "type": "chat.response.complete",
  "session_id": "uuid",
  "sources": [
    {
      "document_id": "uuid",
      "document_title": "ĞÑĞ½Ğ¾Ğ²Ñ‹ Ğ´Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ¸ĞºĞ¸",
      "fragment": "...",
      "relevance": 0.89
    }
  ]
}
```

---

### 3.7. Admin Service (Go) - Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾
**ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°**: ĞĞ´Ğ¼Ğ¸Ğ½ÑĞºĞ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ñ‹ Ğ¿Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼ Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸.

Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ´ĞµĞ»ÑÑ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾:
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
- ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¹
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
- ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸

---

## 4. Message Broker (NATS)

### 4.1. ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ NATS?
- âœ… Ğ›ĞµĞ³ĞºĞ¾Ğ²ĞµÑĞ½Ñ‹Ğ¹ Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹
- âœ… Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° pub/sub, request-reply, queueing
- âœ… JetStream Ğ´Ğ»Ñ Ğ¿ĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
- âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Go Ğ¸ Python
- âœ… ĞœĞµĞ½ÑŒÑˆĞµ overhead Ñ‡ĞµĞ¼ RabbitMQ/Kafka

### 4.2. Ğ¢Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ subjects

```
# Authentication
auth.user.registered
auth.user.login
auth.user.logout
auth.password.reset

# Documents
corpus.document.created
corpus.document.updated
corpus.document.deleted
corpus.author.created

# Indexing
indexing.document.indexed
indexing.document.failed

# User actions
user.fragment.created
user.fragment.deleted
user.note.created
user.chat.history_deleted

# Chat
chat.message.created
chat.session.started
```

### 4.3. JetStream Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

**ĞŸĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ¸Ğ¼Ñ‹**:
- `DOCUMENTS` - Ğ²ÑĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
- `CHAT_HISTORY` - Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ° (Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ)
- `AUDIT_LOG` - Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²

**Retention policy**: 30 Ğ´Ğ½ĞµĞ¹ Ğ¸Ğ»Ğ¸ 10GB (Ñ‡Ñ‚Ğ¾ Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚ Ñ€Ğ°Ğ½ÑŒÑˆĞµ)

---

## 5. Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (PostgreSQL)

### 5.1. ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

```sql
-- Users & Auth
users
registration_requests
refresh_tokens

-- Corpus
authors
documents
document_versions

-- User Content
fragments
notes
chat_sessions
chat_messages

-- Vectors (pgvector)
document_embeddings
```

### 5.2. Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

```sql
-- ĞŸĞ¾Ğ¸ÑĞº Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²
CREATE INDEX idx_fragments_user ON fragments(user_id);
CREATE INDEX idx_fragments_document ON fragments(document_id);
CREATE INDEX idx_fragments_share_token ON fragments(share_token);

-- Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº
CREATE INDEX idx_embedding_search ON document_embeddings 
USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

-- ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼
CREATE INDEX idx_documents_tags ON documents USING GIN (tags);

-- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ°
CREATE INDEX idx_chat_messages_session ON chat_messages(session_id);
CREATE INDEX idx_chat_sessions_user ON chat_sessions(user_id);
```

---

## 6. ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Redis)

### 6.1. Use cases

**Sessions**:
- `session:{user_id}` - JWT refresh tokens
- TTL: 7 Ğ´Ğ½ĞµĞ¹

**Rate Limiting**:
- `ratelimit:{user_id}:{endpoint}` - ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- TTL: 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°

**Chat Context Cache**:
- `chat:context:{session_id}` - Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
- TTL: 1 Ñ‡Ğ°Ñ

**Document Cache**:
- `document:{document_id}` - Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
- TTL: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚

---

## 7. Frontend (SvelteKit)

### 7.1. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ +page.svelte                  # Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ +page.svelte
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â”‚   â””â”€â”€ +page.svelte
â”‚   â”‚   â”œâ”€â”€ corpus/
â”‚   â”‚   â”‚   â”œâ”€â”€ +page.svelte              # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ +page.svelte          # ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â””â”€â”€ +page.svelte              # Ğ§Ğ°Ñ‚ Ñ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¾Ğ¼
â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”œâ”€â”€ fragments/
â”‚   â”‚   â”‚   â”œâ”€â”€ notes/
â”‚   â”‚   â”‚   â””â”€â”€ history/
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ requests/
â”‚   â”‚       â”œâ”€â”€ users/
â”‚   â”‚       â””â”€â”€ documents/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.svelte
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.svelte
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Footer.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ corpus/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentCard.svelte
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentViewer.svelte
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FragmentHighlighter.svelte
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SearchBar.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInterface.svelte
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.svelte
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInput.svelte
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ModeToggle.svelte
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ documents.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts              # Axios/Fetch wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ corpus.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ markdown.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket.ts
â”‚   â”‚   â”‚   â””â”€â”€ fragments.ts
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ app.html
â”‚   â””â”€â”€ app.css
â”œâ”€â”€ static/
â”œâ”€â”€ svelte.config.js
â”œâ”€â”€ vite.config.ts
â””â”€â”€ package.json
```

### 7.2. ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

**SSR/SPA Hybrid**:
- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ (Ğ³Ğ»Ğ°Ğ²Ğ½Ğ°Ñ, Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ) - SSG
- Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ (Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹, Ñ‡Ğ°Ñ‚) - CSR
- SEO-ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ - SSR

**WebSocket Ğ´Ğ»Ñ Ñ‡Ğ°Ñ‚Ğ°**:
- Ğ ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Svelte store
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ reconnect
- Streaming Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¾Ñ‚ LLM

**Svelte Stores Ğ´Ğ»Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ**:
- `authStore` - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ, Ñ‚Ğ¾ĞºĞµĞ½Ñ‹
- `documentsStore` - ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ², ĞºÑÑˆ
- `chatStore` - Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ ÑĞµÑÑĞ¸Ñ, ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
- `fragmentsStore` - ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ñ‹

---

## 8. Ollama Integration

### 8.1. ĞœĞ¾Ğ´ĞµĞ»Ğ¸

**LLM Ğ´Ğ»Ñ Ñ‡Ğ°Ñ‚Ğ°**:
- `llama3.1:8b` (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ, Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ/ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾)
- `mistral:7b` (Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°)
- `llama3.1:70b` (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¼Ğ¾Ñ‰Ğ½Ğ¾Ğµ Ğ¶ĞµĞ»ĞµĞ·Ğ¾)

**Embeddings**:
- `nomic-embed-text` (768 dimensions, Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ´Ğ»Ñ RAG)
- ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°: `all-minilm:l6-v2` (384 dimensions, Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ)

### 8.2. ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

**Ollama Server**:
```yaml
# docker-compose.yml
ollama:
  image: ollama/ollama:latest
  ports:
    - "11434:11434"
  volumes:
    - ollama_models:/root/.ollama
  deploy:
    resources:
      reservations:
        devices:
          - driver: nvidia
            count: 1
            capabilities: [gpu]
```

**Preload Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹**:
```bash
docker exec ollama ollama pull llama3.1:8b
docker exec ollama ollama pull nomic-embed-text
```

### 8.3. API Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ

**Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°** (Chat Service â†’ Ollama):
```
POST http://ollama:11434/api/chat
{
  "model": "llama3.1:8b",
  "messages": [...],
  "stream": true,
  "options": {
    "temperature": 0.7,
    "top_p": 0.9,
    "num_ctx": 4096
  }
}
```

**Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²** (Indexing Service â†’ Ollama):
```
POST http://ollama:11434/api/embeddings
{
  "model": "nomic-embed-text",
  "prompt": "Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ°"
}
```

---

## 9. Deployment

### 9.1. Docker Compose (Production)

```yaml
version: '3.8'

services:
  postgres:
    image: pgvector/pgvector:pg16
    environment:
      POSTGRES_DB: raibecas
      POSTGRES_USER: raibecas
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready"]
      interval: 10s

  redis:
    image: redis:7-alpine
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data

  nats:
    image: nats:latest
    command: 
      - "-js"
      - "-sd=/data"
    ports:
      - "4222:4222"
      - "8222:8222"  # monitoring
    volumes:
      - nats_data:/data

  meilisearch:
    image: getmeili/meilisearch:v1.5
    environment:
      MEILI_MASTER_KEY: ${MEILI_MASTER_KEY}
    volumes:
      - meilisearch_data:/meili_data

  ollama:
    image: ollama/ollama:latest
    volumes:
      - ollama_models:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  # ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
  api-gateway:
    build: ./services/api-gateway
    environment:
      NATS_URL: nats://nats:4222
      REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379
      JWT_SECRET: ${JWT_SECRET}
    ports:
      - "8080:8080"
    depends_on:
      - nats
      - redis

  auth-service:
    build: ./services/auth-service
    environment:
      DATABASE_URL: postgres://raibecas:${DB_PASSWORD}@postgres:5432/raibecas
      NATS_URL: nats://nats:4222
    depends_on:
      - postgres
      - nats

  corpus-service:
    build: ./services/corpus-service
    environment:
      DATABASE_URL: postgres://raibecas:${DB_PASSWORD}@postgres:5432/raibecas
      NATS_URL: nats://nats:4222
      MEILISEARCH_URL: http://meilisearch:7700
      MEILISEARCH_KEY: ${MEILI_MASTER_KEY}
    depends_on:
      - postgres
      - nats
      - meilisearch

  user-service:
    build: ./services/user-service
    environment:
      DATABASE_URL: postgres://raibecas:${DB_PASSWORD}@postgres:5432/raibecas
      NATS_URL: nats://nats:4222
    depends_on:
      - postgres
      - nats

  indexing-service:
    build: ./services/indexing-service
    environment:
      DATABASE_URL: postgres://raibecas:${DB_PASSWORD}@postgres:5432/raibecas
      NATS_URL: nats://nats:4222
      OLLAMA_URL: http://ollama:11434
      MEILISEARCH_URL: http://meilisearch:7700
    depends_on:
      - postgres
      - nats
      - ollama
      - meilisearch

  chat-service:
    build: ./services/chat-service
    environment:
      DATABASE_URL: postgres://raibecas:${DB_PASSWORD}@postgres:5432/raibecas
      NATS_URL: nats://nats:4222
      OLLAMA_URL: http://ollama:11434
      REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379
    depends_on:
      - postgres
      - nats
      - ollama
      - redis

  frontend:
    build: ./frontend
    environment:
      PUBLIC_API_URL: http://api-gateway:8080
      PUBLIC_WS_URL: ws://api-gateway:8080
    depends_on:
      - api-gateway

  nginx:
    image: nginx:alpine
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - frontend

volumes:
  postgres_data:
  redis_data:
  nats_data:
  meilisearch_data:
  ollama_models:
```

### 9.2. Hardware Requirements

**ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)**:
- CPU: 4 cores
- RAM: 16GB
- GPU: 6GB VRAM (Ğ´Ğ»Ñ llama3.1:8b)
- Disk: 50GB SSD

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ (production)**:
- CPU: 8+ cores
- RAM: 32GB
- GPU: RTX 3090 / 4090 Ğ¸Ğ»Ğ¸ A100 (24GB VRAM)
- Disk: 100GB NVMe SSD

---

## 10. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Observability

### 10.1. Prometheus Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸

**ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚**:
- HTTP request duration (histogram)
- HTTP request count (counter)
- Active connections (gauge)
- NATS message processing time
- Database query duration
- Error rate

**Ollama ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹Ğµ**:
- Token generation speed (tokens/sec)
- Model loading time
- GPU utilization
- Context window usage

### 10.2. Grafana Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹

1. **System Overview**: CPU, RAM, Disk, Network
2. **Services Health**: Request rate, errors, latency
3. **NATS Broker**: Message throughput, queue depth
4. **Database**: Query performance, connection pool
5. **Ollama**: Model performance, GPU metrics
6. **User Activity**: Active users, chat sessions, documents viewed

### 10.3. Distributed Tracing

**ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾**: Jaeger Ğ¸Ğ»Ğ¸ Tempo Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞ¹ÑĞ¸Ğ½Ğ³Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

---

## 11. Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### 11.1. ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
- JWT access tokens (15 Ğ¼Ğ¸Ğ½) + refresh tokens (7 Ğ´Ğ½ĞµĞ¹)
- bcrypt Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ (cost=12)
- Redis Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ refresh tokens

### 11.2. ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- RBAC: `user` | `admin`
- Middleware Ğ² API Gateway
- Service-to-service authentication Ñ‡ĞµÑ€ĞµĞ· NATS credentials

### 11.3. Network Security
- Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ² Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğ¹ Docker ÑĞµÑ‚Ğ¸
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Nginx Ğ¸ API Gateway exposed
- NATS authentication
- PostgreSQL SSL connections

### 11.4. Rate Limiting
- User: 100 req/min (API), 10 msg/min (chat)
- Admin: 1000 req/min
- IP-based Ğ´Ğ»Ñ Ğ½ĞµĞ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ…: 20 req/min

---

## 12. ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ

### 12.1. Horizontal Scaling

**Stateless ÑĞµÑ€Ğ²Ğ¸ÑÑ‹** (Ğ»ĞµĞ³ĞºĞ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒÑÑ‚ÑÑ):
- Auth Service
- Corpus Service
- User Service
- API Gateway

**Stateful ÑĞµÑ€Ğ²Ğ¸ÑÑ‹** (Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸):
- Chat Service (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Redis Ğ´Ğ»Ñ ÑˆĞ°Ñ€Ğ¸Ğ½Ğ³Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ)

### 12.2. Database Scaling

**Ğ”Ğ»Ñ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾**:
- Read replicas Ğ´Ğ»Ñ PostgreSQL
- Partitioning Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† (`chat_messages`)
- Separate DB Ğ´Ğ»Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² (Qdrant/Weaviate)

### 12.3. Message Broker Scaling

NATS Cluster Ñ JetStream Ğ´Ğ»Ñ HA (3+ Ğ½Ğ¾Ğ´Ñ‹)

---

## 13. Testing Strategy

### 13.1. Unit Tests
- Go: `go test` Ğ´Ğ»Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- Python: `pytest` Ğ´Ğ»Ñ ML pipeline
- Svelte: `vitest` Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

### 13.2. Integration Tests
- Testcontainers Ğ´Ğ»Ñ PostgreSQL, Redis, NATS
- Mock Ollama API

### 13.3. E2E Tests
- Playwright Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… user flows
- CI/CD pipeline

---

## 14. Development Workflow

### 14.1. Local Development

```bash
# ĞŸĞ¾Ğ´Ğ½ÑÑ‚ÑŒ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ
docker-compose -f docker-compose.dev.yml up -d

# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ² dev mode (Ñ hot reload)
cd services/auth-service && air  # Go hot reload
cd services/chat-service && uvicorn main:app --reload
cd frontend && npm run dev
```

### 14.2. CI/CD

**GitHub Actions**:
1. Lint + Test Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ PR
2. Build Docker images
3. Deploy to staging (on merge to `develop`)
4. Deploy to production (on tag)

---

## 15. Roadmap

### Phase 1: Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (4-6 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
- âœ… Docker Compose setup
- âœ… PostgreSQL + pgvector schema
- âœ… NATS broker setup
- âœ… Auth Service (Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ, Ğ»Ğ¾Ğ³Ğ¸Ğ½)
- âœ… Corpus Service (CRUD Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²)
- âœ… API Gateway
- âœ… SvelteKit frontend scaffold
- âœ… Basic UI (Ğ»Ğ¾Ğ³Ğ¸Ğ½, Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²)

### Phase 2: Core Features (4-6 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
- âœ… User Service (Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ñ‹, Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸)
- âœ… Fragment highlighting Ğ¸ sharing
- âœ… Meilisearch integration
- âœ… Admin panel (Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¹)
- âœ… ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½

### Phase 3: AI Integration (4-6 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
- âœ… Ollama setup
- âœ… Indexing Service (chunking, embeddings)
- âœ… Chat Service (RAG pipeline)
- âœ… WebSocket Ñ‡Ğ°Ñ‚ Ğ² UI
- âœ… Ğ”Ğ²Ğ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹)
- âœ… Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ°

### Phase 4: Polish & Production (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
- âœ… ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
- âœ… Comprehensive testing
- âœ… Monitoring setup (Prometheus + Grafana)
- âœ… Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- âœ… Production deployment

**Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 14-21 Ğ½ĞµĞ´ĞµĞ»ÑŒ (~3.5-5 Ğ¼ĞµÑÑÑ†ĞµĞ²)**

---

## 16. Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ (Multi-Philosopher Support)

### 16.1. ĞĞ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ ĞĞ²Ñ‚Ğ¾Ñ€Ğ°

**Database**:
```sql
-- ĞĞ²Ñ‚Ğ¾Ñ€Ñ‹ Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ñ‹Ğ¼Ğ¸ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
CREATE TABLE authors (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) UNIQUE NOT NULL,
    bio TEXT,
    metadata JSONB,  -- ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°
    created_at TIMESTAMP DEFAULT NOW()
);

-- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚Ğ° Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°
CREATE TABLE author_chat_configs (
    author_id UUID REFERENCES authors(id),
    system_prompt TEXT NOT NULL,
    temperature FLOAT DEFAULT 0.7,
    model_name VARCHAR(100),  -- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²
    vector_collection VARCHAR(100),  -- ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²
    PRIMARY KEY (author_id)
);
```

### 16.2. Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

**Frontend** (SvelteKit):
```
routes/
â”œâ”€â”€ philosophers/
â”‚   â”œâ”€â”€ [slug]/
â”‚   â”‚   â”œâ”€â”€ +page.svelte         # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ°
â”‚   â”‚   â”œâ”€â”€ documents/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/+page.svelte
â”‚   â”‚   â””â”€â”€ chat/
â”‚   â”‚       â””â”€â”€ +page.svelte     # Ğ§Ğ°Ñ‚ Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¼ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¾Ğ¼
```

**URL Examples**:
- `/philosophers/raibecas` - ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ Ğ°Ğ¹Ğ±ĞµĞºĞ°ÑĞ°
- `/philosophers/raibecas/chat` - Ñ‡Ğ°Ñ‚ Ñ Ğ Ğ°Ğ¹Ğ±ĞµĞºĞ°ÑĞ¾Ğ¼
- `/philosophers/kant/chat` - Ğ² Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼: Ñ‡Ğ°Ñ‚ Ñ ĞšĞ°Ğ½Ñ‚Ğ¾Ğ¼

### 16.3. Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ²

ĞŸÑ€Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°:
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ namespace Ğ² pgvector: `embeddings_{author_slug}`
2. Ğ˜Ğ½Ğ´ĞµĞºÑĞ¸Ñ€ÑƒÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµĞ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ñ‹
3. RAG search Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ ĞµĞ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼

---

## ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

### A. Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

**Go**:
- `github.com/gofiber/fiber/v2` - Ğ²ĞµĞ±-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº
- `github.com/nats-io/nats.go` - NATS client
- `github.com/jmoiron/sqlx` - PostgreSQL
- `github.com/golang-jwt/jwt/v5` - JWT
- `github.com/go-redis/redis/v8` - Redis
- `github.com/gofiber/websocket/v2` - WebSocket

**Python**:
- `fastapi` - Ğ²ĞµĞ±-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº
- `nats-py` - NATS client
- `httpx` - HTTP client Ğ´Ğ»Ñ Ollama
- `sentence-transformers` - Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¸ (fallback)
- `sqlalchemy` - ORM
- `websockets` - WebSocket server

**Frontend (Svelte)**:
- `svelte` + `sveltekit` - Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº
- `tailwindcss` - ÑÑ‚Ğ¸Ğ»Ğ¸
- `marked` - Markdown Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³
- `highlight.js` - Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ°
- `@sveltejs/adapter-node` - SSR deployment

### B. ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

**RabbitMQ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ NATS**:
- Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ±Ğ¾Ğ»ĞµĞµ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ routing patterns
- Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ overhead, Ğ½Ğ¾ Ğ±Ğ¾Ğ³Ğ°Ñ‡Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»

**Qdrant/Weaviate Ğ²Ğ¼ĞµÑÑ‚Ğ¾ pgvector**:
- Ğ•ÑĞ»Ğ¸ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ‘Ğ” ÑÑ‚Ğ°Ğ½ĞµÑ‚ ÑƒĞ·ĞºĞ¸Ğ¼ Ğ¼ĞµÑÑ‚Ğ¾Ğ¼
- Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ñ Ğ»ÑƒÑ‡ÑˆĞµĞ¹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ
- Ğ›ĞµĞ³ĞºĞ¾ Ğ¼Ğ¸Ğ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ: NATS event â†’ Ğ¿ĞµÑ€ĞµĞ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ

**Monorepo vs Polyrepo**:
- Monorepo (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ): Ğ¿Ñ€Ğ¾Ñ‰Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
- Polyrepo: ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾

---

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

Ğ”Ğ°Ğ½Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚:
- âœ… **ĞĞ°ÑÑ‚Ğ¾ÑÑ‰ÑƒÑ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ½ÑƒÑ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ** Ñ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸ĞµĞ¹
- âœ… **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ stateless ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²)
- âœ… **ĞÑ‚ĞºĞ°Ğ·Ğ¾ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ** (Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ event-driven Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñƒ Ğ¸ JetStream)
- âœ… **Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ** (Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¾Ğ²/Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²)
- âœ… **ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** (Ollama, Ğ±ĞµĞ· Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… API)
- âœ… **Ğ¡Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑ‚ĞµĞº** (Go, Python, SvelteKit, NATS)

Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸! ğŸš€